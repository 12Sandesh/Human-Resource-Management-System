{% extends 'base/base.html' %} {% block title %}Dashboard{% endblock title %} {%
block content %}
<main class="content flex-grow-1" style="padding-top: 80px">
  <div class="container-fluid">
    <!-- Page Header -->
    <div class="page-header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h2 class="mb-1">Welcome back, {{ employee.user.first_name }}!</h2>
            <p class="employee-info mb-0">
              <i class="bi bi-person-badge"></i> {{ employee.employee_id }} | {%
              if employee.department %}{{ employee.department.name }}{% else
              %}No Department{% endif %} - {% if employee.job_role %}{{
              employee.job_role.title }}{% else %}No Role Assigned{% endif %}
            </p>
          </div>
          <div class="col-md-4 text-md-end">
            <div class="d-flex align-items-center justify-content-md-end">
              <i class="bi bi-calendar-event me-2"></i>
              <span id="current-date"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="row g-4 mb-5 fade-in-up">
      <div class="col-lg-4 col-md-6">
        <div class="stats-card attendance">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <h3>{{ present_days }}</h3>
              <p>Days Present</p>
              <small class="opacity-75">
                {% if attendance_rate == 100 %} Perfect attendance this month!
                {% elif attendance_rate >= 90 %} Excellent attendance ({{
                attendance_rate }}%) {% elif attendance_rate >= 75 %} Good
                attendance ({{ attendance_rate }}%) {% else %} Attendance: {{
                attendance_rate }}% {% endif %}
              </small>
            </div>
            <div class="stats-icon">
              <i class="bi bi-calendar-check" style="font-size: 2rem"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4 col-md-6">
        <div class="stats-card leaves">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <h3>{{ remaining_leaves }}</h3>
              <p>Leaves Available</p>
              <small class="opacity-75">
                {% if remaining_leaves > 10 %} Plan your vacations {% elif
                remaining_leaves > 5 %} Use them wisely {% else %} Limited
                leaves left {% endif %}
              </small>
            </div>
            <div class="stats-icon">
              <i class="bi bi-calendar-x" style="font-size: 2rem"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4 col-md-6">
        <div class="stats-card payroll">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              {% if latest_payroll %}
              <h3>${{ latest_payroll.net_salary|floatformat:0 }}</h3>
              <p>Last Payroll</p>
              <small class="opacity-75"
                >Paid on {{ latest_payroll.payment_date|date:"M d, Y" }}</small
              >
              {% else %}
              <h3>--</h3>
              <p>No Payroll</p>
              <small class="opacity-75">No payroll records found</small>
              {% endif %}
            </div>
            <div class="stats-icon">
              <i class="bi bi-cash-coin" style="font-size: 2rem"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions & Recent Activity -->
    <div class="row g-4 mb-5">
      <!-- Quick Actions -->
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="bi bi-lightning-charge"></i> Quick Actions
            </h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-6">
                {% if attendance_marked_today %}
                <button class="btn btn-outline-success w-100 btn-lg" disabled>
                  <i class="bi bi-check-circle-fill"></i>
                  <br />Attendance Marked
                </button>
                {% else %}
                <a
                  href="{% url 'employee-attendance' employee_id=employee.employee_id %}"
                  class="btn btn-success w-100 btn-lg text-decoration-none"
                >
                  <i class="bi bi-clock-fill"></i>
                  <br />Mark Attendance
                </a>
                {% endif %}
              </div>
              <div class="col-6">
                <a
                  href="{% url 'employee-leave' employee_id=employee.employee_id %}"
                  class="btn btn-primary w-100 btn-lg text-decoration-none"
                >
                  <i class="bi bi-calendar-plus"></i>
                  <br />Apply Leave {% if pending_leaves_count > 0 %}
                  <span
                    class="badge bg-warning position-absolute top-0 start-100 translate-middle"
                  >
                    {{ pending_leaves_count }}
                  </span>
                  {% endif %}
                </a>
              </div>
              <div class="col-6">
                <a
                  href="{% url 'employee-payroll' employee_id=employee.employee_id %}"
                  class="btn btn-info w-100 btn-lg text-decoration-none text-white"
                >
                  <i class="bi bi-file-earmark-text"></i>
                  <br />View Payslip
                </a>
              </div>
              <div class="col-6">
                <button
                  class="btn btn-warning w-100 btn-lg"
                  onclick="alert('Profile update feature coming soon!')"
                >
                  <i class="bi bi-person-gear"></i>
                  <br />Update Profile
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Notifications -->
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="bi bi-bell"></i> Recent Notifications
            </h5>
          </div>
          <div class="card-body">
            <div class="notification-list">
              {% if notifications %} {% for notification in notifications %}
              <div
                class="notification-item d-flex align-items-start mb-3 p-3 bg-light rounded-3"
              >
                <div class="notification-icon me-3">
                  <i class="{{ notification.icon }}"></i>
                </div>
                <div class="flex-grow-1">
                  <h6 class="mb-1">{{ notification.title }}</h6>
                  <p class="mb-1 text-muted">{{ notification.message }}</p>
                  <small class="text-muted">
                    {% if notification.time %} {% with
                    now=notification.time|timesince %} {% if "minute" in now %}
                    {{ now }} ago {% elif "hour" in now %} {{ now }} ago {% elif
                    "day" in now %} {{ now }} ago {% else %} {{
                    notification.time|date:"M d, Y" }} {% endif %} {% endwith %}
                    {% endif %}
                  </small>
                </div>
              </div>
              {% endfor %} {% else %}
              <div class="text-center text-muted py-4">
                <i class="bi bi-bell-slash display-4 mb-3"></i>
                <p>No recent notifications</p>
              </div>
              {% endif %}
            </div>

            <div class="text-center mt-3">
              <button
                class="btn btn-outline-primary btn-sm"
                onclick="alert('Notifications feature coming soon!')"
              >
                <i class="bi bi-arrow-right"></i> View All Notifications
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Overview -->
    <div class="row g-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="bi bi-graph-up"></i> Monthly Performance Overview
            </h5>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-md-3">
                <div class="metric-box">
                  <div class="metric-number">{{ attendance_rate }}%</div>
                  <div class="metric-label">Attendance Rate</div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="metric-box">
                  <div class="metric-number">{{ tasks_completed }}</div>
                  <div class="metric-label">Days Present</div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="metric-box">
                  <div class="metric-number">
                    {{ performance_score|floatformat:0 }}%
                  </div>
                  <div class="metric-label">Performance Score</div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="metric-box">
                  <div class="metric-number">{{ remaining_leaves }}</div>
                  <div class="metric-label">Leaves Remaining</div>
                </div>
              </div>
            </div>

            <!-- Additional Stats Row -->
            <hr class="my-4" />
            <div class="row text-center">
              <div class="col-md-3">
                <div class="metric-box">
                  <div class="metric-number text-success">
                    {{ present_days }}
                  </div>
                  <div class="metric-label">Present Days</div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="metric-box">
                  <div class="metric-number text-danger">{{ absent_days }}</div>
                  <div class="metric-label">Absent Days</div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="metric-box">
                  <div class="metric-number text-warning">{{ leave_days }}</div>
                  <div class="metric-label">Leave Days</div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="metric-box">
                  {% if ytd_earnings %}
                  <div class="metric-number text-info">
                    ${{ ytd_earnings|floatformat:0 }}
                  </div>
                  <div class="metric-label">YTD Earnings</div>
                  {% else %}
                  <div class="metric-number text-muted">--</div>
                  <div class="metric-label">YTD Earnings</div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Leave Breakdown (if has leave data) -->
    {% if leave_breakdown %}
    <div class="row g-4 mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="bi bi-calendar-range"></i> Leave Balance Breakdown
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              {% for leave_type, data in leave_breakdown.items %}
              <div class="col-md-4 mb-3">
                <div class="p-3 border rounded">
                  <h6 class="text-primary">{{ leave_type }} Leave</h6>
                  <div class="d-flex justify-content-between">
                    <span>Used:</span>
                    <strong class="text-danger">{{ data.used }} days</strong>
                  </div>
                  <div class="d-flex justify-content-between">
                    <span>Remaining:</span>
                    <strong class="text-success"
                      >{{ data.remaining }} days</strong
                    >
                  </div>
                  <!-- Progress bar -->
                  <div class="progress mt-2" style="height: 6px">
                    {% widthratio data.used 10 100 as used_percentage %}
                    <div
                      class="progress-bar bg-danger"
                      style="width: {{ used_percentage }}%"
                    ></div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</main>

<script>
  // Display current date
  document.getElementById("current-date").textContent =
    new Date().toLocaleDateString("en-US", {
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric",
    });

  // Add fade-in animation to cards
  document.addEventListener("DOMContentLoaded", function () {
    const cards = document.querySelectorAll(".card");
    cards.forEach((card, index) => {
      setTimeout(() => {
        card.classList.add("fade-in-up");
      }, index * 100);
    });
  });

  // Add tooltip functionality for metrics (requires Bootstrap)
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize tooltips if Bootstrap is available
    if (typeof bootstrap !== "undefined") {
      var tooltipTriggerList = [].slice.call(
        document.querySelectorAll('[data-bs-toggle="tooltip"]')
      );
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    }
  });
</script>

{% endblock content %}
